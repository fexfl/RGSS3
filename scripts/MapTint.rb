module UNITATEM module MapTint
    #==============================================================================
    # Map Tinting
    # -----------------------------------------------------------------------------
    # 6.10.2023
    # -----------------------------------------------------------------------------
    #==============================================================================
    # # Introduction
    #
    # Allows setting the screen Tint for each map in the note box, which allows for
    # automatic tinting without using an event.
    # 
    #==============================================================================
    # # Usage
    #
    # Map notetags:
    # <map tint: r,g,b,gr>
    # <map tint: -r,-g,-b,-gr>
    # 
    # Possile are entries like +x, -x, x
    #
    # Beware that entering numbers above 255 or negative numbers for grayscale
    # does not result in an error!
    # 
    #==============================================================================
    # # SETTINGS
    # -----------------------------------------------------------------------------
    TINT_STR = /<(?:MAP_TINT|map tint):[ ](([\+\-]\d+)(?:\s*,\s*([\+\-]?\d+))*)>/i
    DURATION = 60
    end end
    #==============================================================================
    # Importing the script
    #------------------------------------------------------------------------------
    $imported = {} if $imported.nil? ; $imported[:UNITATEM_MAPTINT] = true
    #==============================================================================
    # ** RPG::Map
    #------------------------------------------------------------------------------
    #==============================================================================
    
    class RPG::Map
      #--------------------------------------------------------------------------
      # accessors
      #--------------------------------------------------------------------------
      attr_accessor :map_tint
    
      #--------------------------------------------------------------------------
      # common cache: load_notetags_mt
      #--------------------------------------------------------------------------
      def load_notetags_mt
        @map_tint = Tone.new(0,0,0,0)
        #---
        self.note.split(/[\r\n]+/).each { |line|
          case line
          when UNITATEM::MapTint::TINT_STR
            temp_array = []
            $1.scan(/[\+\-]?\d+/).each { |num|
            temp_array.push(num.to_i) }
            @map_tint = Tone.new(temp_array[0], temp_array[1], temp_array[2], temp_array[3])
          end
        }
      end
    end
    #==============================================================================
    # ** GameMap
    #------------------------------------------------------------------------------
    #==============================================================================
    class Game_Map
      
      #--------------------------------------------------------------------------
      # alias method: setup
      #--------------------------------------------------------------------------
      alias setup_mt setup;
      def setup(map_id)
        setup_mt(map_id)
        @map.load_notetags_mt
      end
      
      #--------------------------------------------------------------------------
      # new method: get_map_tint
      #--------------------------------------------------------------------------
      def get_map_tint
        return @map.map_tint
      end
    end
    #==============================================================================
    # ** GamePlayer
    #------------------------------------------------------------------------------
    #==============================================================================
    class Game_Player
      #--------------------------------------------------------------------------
      # alias method: perform_transfer
      #--------------------------------------------------------------------------
      alias perform_transfer_mt perform_transfer
      def perform_transfer
        perform_transfer_mt
        $game_message.add("Test")
        $game_map.screen.start_tone_change($game_map.get_map_tint, UNITATEM::MapTint::DURATION)
      end
    end